<st-checkout-layout>
  <ng-container st-checkout-layout-content>
    @if (cards()) {
      @if (isUpdating()) {
        <div class="cx-spinner">
          <cx-spinner></cx-spinner>
        </div>
      } @else {
        <div
          *cxFeature="'!a11yRemoveStatusLoadedRole'"
          role="status"
          [attr.aria-label]="'common.loaded' | cxTranslate"
        ></div>
        @if (cards()?.length && !addressFormOpened()) {
          <p class="cx-checkout-text">
            {{ 'checkoutAddress.selectYourDeliveryAddress' | cxTranslate }}
          </p>

          <div class="cx-checkout-btns cx-checkout-btns-top mb-4">
            <button
              class="btn btn-block btn-secondary"
              (click)="showNewAddressForm()"
            >
              {{ 'checkoutAddress.addNewAddress' | cxTranslate }}
            </button>
          </div>

          <div class="cx-checkout-body row">
            @for (card of cards(); track card; let i = $index) {
              <div class="cx-delivery-address-card col-md-12 col-lg-6">
                <div
                  class="cx-delivery-address-card-inner h-100"
                  (click)="selectAddress(card.address)"
                >
                  <cx-card
                    [border]="true"
                    [index]="i"
                    [fitToContainer]="true"
                    [content]="card.card"
                    (sendCard)="selectAddress(card.address)"
                  ></cx-card>
                </div>
              </div>
            }
          </div>

          <div class="cx-checkout-btns cx-checkout-btns-bottom mt-4">
            <button
              class="btn btn-block btn-secondary"
              (click)="showNewAddressForm()"
            >
              {{ 'checkoutAddress.addNewAddress' | cxTranslate }}
            </button>
          </div>

          <div class="cx-checkout-btns row mt-4">
            <div class="col-md-12 col-lg-6">
              <button class="cx-btn btn btn-block btn-secondary" (click)="back()">
                {{ backBtnText | cxTranslate }}
              </button>
            </div>
            <div class="col-md-12 col-lg-6">
              <button
                class="cx-btn btn btn-block btn-primary"
                [disabled]="!(selectedAddress$ | async)?.id"
                (click)="next()"
              >
                {{ 'common.continue' | cxTranslate }}
              </button>
            </div>
          </div>
        } @else {
          @if (cards()?.length) {
            <cx-address-form
              [showTitleCode]="true"
              (backToAddress)="hideNewAddressForm(false)"
              (submitAddress)="addAddress($event)"
            ></cx-address-form>
          } @else {
            <cx-address-form
              [showTitleCode]="true"
              [setAsDefaultField]="!isGuestCheckout"
              [addressData]="selectedAddress()"
              cancelBtnLabel="{{ backBtnText | cxTranslate }}"
              (backToAddress)="hideNewAddressForm(true)"
              (submitAddress)="addAddress($event)"
            ></cx-address-form>
          }
        }
      }
    }
  </ng-container>
</st-checkout-layout>
