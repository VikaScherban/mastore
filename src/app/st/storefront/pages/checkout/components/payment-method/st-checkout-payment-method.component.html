<st-checkout-layout>
  <ng-container st-checkout-layout-content>
    @if (cards()) {
      @if (isUpdating()) {
        <div class="cx-spinner">
          <cx-spinner></cx-spinner>
        </div>
      } @else {
        <div
          *cxFeature="'!a11yRemoveStatusLoadedRole'"
          role="status"
          [attr.aria-label]="'common.loaded' | cxTranslate"
        ></div>
        @if (cards?.length && !newPaymentFormManuallyOpened) {
          <p class="cx-checkout-text">
            {{ 'paymentForm.choosePaymentMethod' | cxTranslate }}
          </p>

          <div class="cx-checkout-btns cx-checkout-btns-top">
            <button
              class="btn btn-block btn-secondary"
              (click)="showNewPaymentForm()"
            >
              {{ 'paymentForm.addNewPayment' | cxTranslate }}
            </button>
          </div>

          <div class="cx-checkout-body row">
            @for (card of cards(); track card; let i = $index) {
              <div class="cx-payment-card col-md-12 col-lg-6">
                <div
                  class="cx-payment-card-inner"
                  (click)="selectPaymentMethod(card.paymentMethod)"
                >
                  <cx-card
                    [border]="true"
                    [fitToContainer]="true"
                    [content]="card.content"
                    [index]="i"
                    (sendCard)="selectPaymentMethod(card.paymentMethod)"
                  ></cx-card>
                </div>
              </div>
            }
          </div>

          <div class="cx-checkout-btns cx-checkout-btns-bottom">
            <button
              class="btn btn-block btn-secondary"
              (click)="showNewPaymentForm()"
            >
              {{ 'paymentForm.addNewPayment' | cxTranslate }}
            </button>
          </div>

          <div class="row cx-checkout-btns">
            <div class="col-md-12 col-lg-6">
              <button class="btn btn-block btn-secondary" (click)="back()">
                {{ backBtnText | cxTranslate }}
              </button>
            </div>
            <div class="col-md-12 col-lg-6">
              <button
                class="btn btn-block btn-primary"
                [disabled]="!(selectedMethod$ | async)?.id"
                (click)="next()"
              >
                {{ 'common.continue' | cxTranslate }}
              </button>
            </div>
          </div>
        } @else {
          <cx-payment-form
            (setPaymentDetails)="setPaymentDetails($event)"
            (closeForm)="hideNewPaymentForm()"
            (goBack)="back()"
            [paymentMethodsCount]="cards()?.length || 0"
            [setAsDefaultField]="!isGuestCheckout && !!cards()?.length"
            [loading]="isUpdating()"
            [paymentDetails]="paymentDetails"
          ></cx-payment-form>
        }
      }
    }

  </ng-container>
</st-checkout-layout>
