@if (isLoading()) {
  <div class="cx-spinner"><cx-spinner></cx-spinner></div>
} @else {
  <div class="st-cart">
    <section class="cx-page-section container">
      <div
        *cxFeature="'!a11yRemoveStatusLoadedRole'"
        role="status"
        [attr.aria-label]="'common.loaded' | cxTranslate"
      ></div>
      <div class="row justify-content-center">
        <div class="col-md-6">
          <div class="cx-section">
            <p *cxFeature="'a11yRequiredAsterisks'" class="form-legend">
              {{ 'formLegend.required' | cxTranslate }}
            </p>
            <form (ngSubmit)="submitForm()" [formGroup]="registerForm">
              @if (titles()) {
                <div class="form-group">
                  <label>
              <span class="label-content">{{
                  'register.titleOptional' | cxTranslate
                }}</span>
                    <ng-select
                      [clearable]="false"
                      [items]="titles()"
                      [placeholder]="'register.selectTitle' | cxTranslate"
                      [searchable]="false"
                      bindLabel="name"
                      bindValue="code"
                      formControlName="titleCode"
                      id="title-select"
                      [cxNgSelectA11y]="{
                  ariaLabel: 'register.title' | cxTranslate,
                }"
                    >
                    </ng-select>
                  </label>
                </div>
              }

              <div class="form-group">
                <label>
              <span class="label-content"
              >{{ 'register.firstName.label' | cxTranslate }}
                <ng-template [ngTemplateOutlet]="requiredAsterisk"></ng-template
                ></span>
                  <input
                    required="true"
                    class="form-control"
                    type="text"
                    name="firstname"
                    placeholder="{{
                  'register.firstName.placeholder' | cxTranslate
                }}"
                    formControlName="firstName"
                  />

                  <cx-form-errors
                    *cxFeature="'formErrorsDescriptiveMessages'"
                    [translationParams]="{
                  label: 'register.firstName.label' | cxTranslate,
                }"
                    [control]="registerForm.get('firstName')"
                  ></cx-form-errors>

                  <cx-form-errors
                    *cxFeature="'!formErrorsDescriptiveMessages'"
                    [control]="registerForm.get('firstName')"
                  ></cx-form-errors>
                </label>
              </div>

              <div class="form-group">
                <label>
              <span class="label-content"
              >{{ 'register.lastName.label' | cxTranslate }}
                <ng-template [ngTemplateOutlet]="requiredAsterisk"></ng-template
                ></span>
                  <input
                    required="true"
                    class="form-control"
                    type="text"
                    name="lastname"
                    placeholder="{{
                  'register.lastName.placeholder' | cxTranslate
                }}"
                    formControlName="lastName"
                  />

                  <cx-form-errors
                    *cxFeature="'formErrorsDescriptiveMessages'"
                    [translationParams]="{
                  label: 'register.lastName.label' | cxTranslate,
                }"
                    [control]="registerForm.get('lastName')"
                  ></cx-form-errors>

                  <cx-form-errors
                    *cxFeature="'!formErrorsDescriptiveMessages'"
                    [control]="registerForm.get('lastName')"
                  ></cx-form-errors>
                </label>
              </div>

              <div class="form-group">
                <label>
              <span class="label-content"
              >{{ 'register.emailAddress.label' | cxTranslate }}
                <ng-template [ngTemplateOutlet]="requiredAsterisk"></ng-template
                ></span>
                  <input
                    required="true"
                    class="form-control"
                    type="email"
                    name="email"
                    placeholder="{{
                  'register.emailAddress.placeholder' | cxTranslate
                }}"
                    formControlName="email"
                  />

                  <cx-form-errors
                    *cxFeature="'formErrorsDescriptiveMessages'"
                    [translationParams]="{
                  label: 'register.emailAddress.label' | cxTranslate,
                }"
                    [control]="registerForm.get('email')"
                  ></cx-form-errors>

                  <cx-form-errors
                    *cxFeature="'!formErrorsDescriptiveMessages'"
                    [control]="registerForm.get('email')"
                  ></cx-form-errors>
                </label>
              </div>

              <div class="form-group">
                <label>
              <span class="label-content"
              >{{ 'register.password.label' | cxTranslate }}
                <ng-template [ngTemplateOutlet]="requiredAsterisk"></ng-template
                ></span>
                  <input
                    required="true"
                    class="form-control"
                    type="password"
                    name="password"
                    placeholder="{{
                  'register.password.placeholder' | cxTranslate
                }}"
                    formControlName="password"
                    [attr.aria-label]="
                  'register.password.placeholder' | cxTranslate
                "
                    aria-describedby="password-input-hint"
                    cxPasswordVisibilitySwitch
                  />
                  <p class="input-hint" id="password-input-hint">
                    {{ 'register.passwordMinRequirements' | cxTranslate }}
                  </p>

                  <cx-form-errors
                    *cxFeature="'formErrorsDescriptiveMessages'"
                    [translationParams]="{
                  label: 'register.password.label' | cxTranslate,
                }"
                    [control]="registerForm.get('password')"
                  ></cx-form-errors>

                  <cx-form-errors
                    *cxFeature="'!formErrorsDescriptiveMessages'"
                    [control]="registerForm.get('password')"
                  ></cx-form-errors>
                </label>
              </div>

              <div class="form-group">
                <label>
              <span class="label-content"
              >{{ 'register.confirmPassword.label' | cxTranslate }}
                <ng-template [ngTemplateOutlet]="requiredAsterisk"></ng-template
                ></span>
                  <input
                    required="true"
                    class="form-control"
                    type="password"
                    name="confirmpassword"
                    placeholder="{{
                  'register.confirmPassword.placeholder' | cxTranslate
                }}"
                    formControlName="passwordconf"
                    [attr.aria-label]="
                  'register.confirmPassword.placeholder' | cxTranslate
                "
                    cxPasswordVisibilitySwitch
                  />

                  <cx-form-errors
                    *cxFeature="'formErrorsDescriptiveMessages'"
                    [translationParams]="{
                  label: 'register.confirmPassword.label' | cxTranslate,
                }"
                    [control]="registerForm.get('passwordconf')"
                  ></cx-form-errors>

                  <cx-form-errors
                    *cxFeature="'!formErrorsDescriptiveMessages'"
                    [control]="registerForm.get('passwordconf')"
                  ></cx-form-errors>
                </label>
              </div>

              <div class="form-group">
                <div class="form-check">
                  @if (anonymousConsent()) {
                    <label>
                      <input
                        type="checkbox"
                        name="newsletter"
                        class="form-check-input"
                        formControlName="newsletter"
                        [checked]="isConsentGiven(anonymousConsent()?.consent)"
                      />
                      <span class="form-check-label">
                  {{ anonymousConsent()?.template }}
                </span>
                    </label>
                  }
                </div>
              </div>

              @if (additionalRegistrationConsents?.length) {
                <div
                  formArrayName="additionalConsents"
                  class="form-group"
                >
                  @for (control of additionalConsents.controls; track control; let index = $index) {
                    <div
                      class="form-check"
                    >
                      @if (additionalRegistrationConsents[index]?.template?.id) {
                        <div>
                          <label>
                            <input
                              type="checkbox"
                              [required]="additionalRegistrationConsents[index].required"
                              [name]="additionalRegistrationConsents[index]?.template?.id"
                              (change)="updateAdditionalConsents($any($event), index)"
                              [formControlName]="index"
                            />
                            <span class="form-check-label">
                    {{ additionalRegistrationConsents[index].template.description }}
                  </span>
                            <cx-form-errors [control]="control"></cx-form-errors>
                          </label>
                        </div>
                      }
                    </div>
                  }
                </div>
              }

              <div class="form-group">
                <div class="form-check">
                  <label>
                    <input
                      required="true"
                      type="checkbox"
                      name="termsandconditions"
                      formControlName="termsandconditions"
                    />
                    <span class="form-check-label">
                  {{ 'register.confirmThatRead' | cxTranslate }}
                      <a
                        [routerLink]="{ cxRoute: 'termsAndConditions' } | cxUrl"
                        target="_blank"
                        rel="noopener noreferrer"
                      >
                    {{ 'register.termsAndConditions' | cxTranslate }}
                  </a>
                  <ng-template
                    [ngTemplateOutlet]="requiredAsterisk"
                  ></ng-template>
                </span>

                    <cx-form-errors
                      *cxFeature="'formErrorsDescriptiveMessages'"
                      [translationParams]="{
                    label: 'register.termsAndConditions' | cxTranslate,
                  }"
                      [control]="registerForm.get('termsandconditions')"
                    ></cx-form-errors>

                    <cx-form-errors
                      *cxFeature="'!formErrorsDescriptiveMessages'"
                      [control]="registerForm.get('termsandconditions')"
                    ></cx-form-errors>
                  </label>
                </div>
              </div>
              <cx-form-errors
                [control]="registerForm.get('captcha')"
              ></cx-form-errors>
              <button type="submit" class="btn btn-block btn-primary">
                {{ 'register.register' | cxTranslate }}
              </button>
              <a
                class="cx-login-link btn-link"
                [routerLink]="{ cxRoute: 'login' } | cxUrl"
              >{{ 'register.signIn' | cxTranslate }}</a
              >
            </form>
          </div>
        </div>
      </div>
    </section>
  </div>
}

<ng-template #requiredAsterisk>
  <abbr
    *cxFeature="'a11yRequiredAsterisks'"
    class="text-decoration-none"
    title="{{ 'common.required' | cxTranslate }}"
  >*</abbr
  >
</ng-template>

<ng-template #loading>
  <div class="cx-spinner"><cx-spinner></cx-spinner></div>
</ng-template>
